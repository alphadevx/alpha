<?xml version="1.0" encoding="UTF-8"?>
<project name="Alpha" default="apidocs" basedir=".">
	<property name="app-root" value="."/>
	<property name="dist-version" value="1.0"/>
	<property name="dist-target" value="alpha-${dist-version}"/>
	
	<target name="dist" depends="clean">
		<!-- make a dist folder and copy all of the application files there -->
		<mkdir dir="${dist-target}"/>
		<!-- now copy the files, less the SVN directories! -->
		<copy todir="${dist-target}">
			<fileset dir="${app-root}">
				<exclude name="**/*.svn"/>
				<exclude name="**/*.project"/>
				<exclude name="**/*.geshi"/>
			</fileset>
		</copy>	
	</target>
		
	<target name="clean">
		<!-- delete the distribution folder -->
		<delete dir="${dist-target}"/>
	</target>

    <target name="apidocs" description="Builds the API HTML docs.">
	<phpdoc title="Alpha Framework API Documentation"
	  destdir="./docs/api"
	  sourcecode="true"
	  undocumentedelements="true"
	  output="HTML:Smarty:HandS">
	   <fileset dir=".">
	      <include name="**/*.php" />
	      <include name="**/*.inc" />
	      <exclude name="**/lib/**"/>
	      <exclude name="**/*.css.php"/>
	      <exclude name="**/*.tbl.php"/>
	      <exclude name="**/*.tbl.php.html"/>
	      <exclude name="**/*.phtml"/>
	   </fileset>
	</phpdoc>
    </target>

    <target name="depends" description="Checks dependancies.">
	<phpdepend>
	   <fileset dir=".">
              <include name="**/*.php" />
              <include name="**/*.inc" />
              <exclude name="**/lib/**"/>
           </fileset>
	   <logger type="jdepend-xml" outfile="docs/depends/jdepend.xml"/>
	   <logger type="jdepend-chart" outfile="docs/depends/jdepend.jpg"/>
	   <logger type="overview-pyramid" outfile="docs/depends/jdepend-pyramid.jpg"/>
	   <analyzer type="coderank-mode" value="method"/>
	 </phpdepend>
    </target>

   <target name="codesniff" description="Checks the code for cleaniness.">
	<phpcodesniffer
	  standard="ruleset.xml"
	  showSniffs="true"
	  showWarnings="true"
	  allowedFileExtensions="php inc">
	<formatter type="default" usefile="false"/>
	<fileset dir=".">
            <include name="**/*.php" />
            <include name="**/*.inc" />
            <exclude name="**/lib/**"/>
         </fileset>
	</phpcodesniffer>
    </target>

    <target name="pmd" description="Project mess detector.">
        <phpmd>
	<fileset dir=".">
            <include name="**/*.php" />
            <include name="**/*.inc" />
            <exclude name="**/lib/**"/>
        </fileset>
        <formatter type="html" outfile="./docs/pmd/pmd.html"/>
        </phpmd>
    </target>
	
</project>